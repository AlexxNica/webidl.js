"use strict";var JSType=function(){function n(){}return n.fromIDL=function(t){var i,r;if(typeof t=="string")return n.fromIDLName(t);if(t.union)return"any";if(t.sequence)return n.fromIDL(t.idlType)+"[]";if(t.array){for(i=n.fromIDL(t.idlType),r=t.array;r;r--)i+="[]";return i}return n.fromIDL(t.idlType)},n.fromIDLName=function(n){switch(n){case"DOMString":case"ByteString":return"string";case"byte":case"octet":case"short":case"unsigned short":case"long":case"unsigned long":case"long long":case"unsigned long long":case"float":case"unrestricted float":case"double":case"unrestricted double":return"number";case"boolean":case"Boolean":return"bool";case"object":case"Object":return"any";case"any":return"any";default:return n}},n}(),JSValue=function(){function n(){}return n.fromIDL=function(n){switch(n.type){case"undefined":return"undefined";case"null":return"null";case"Infinity":return n.negative?"Number.NEGATIVE_INFINITY":"Number.POSITIVE_INFINITY";case"NaN":return"Number.NaN";default:return JSON.stringify(n.value)}},n}(),IndentedStringBuilder=function(){function n(n,t){typeof n=="undefined"&&(n=""),typeof t=="undefined"&&(t=""),this.code=n,this.header=t,this.code&&(this.code=(this.header+this.code).split("\n").join("\n"+this.header))}return n.prototype.append=function(n){this.code=(this.code?this.code+"\n":"")+(this.header+n).split("\n").join("\n"+this.header)},n.prototype.prepend=function(n){this.code=(this.header+n).split("\n").join("\n"+this.header)+(this.code?"\n"+this.code:"")},n.prototype.toString=function(){return this.code},n}(),TypeScriptHelper=function(){function n(n){this.out=n}return n.prototype.log=function(n){this.out.appendChild(document.createTextNode(n+"\n"))},n.prototype.clear=function(){this.out.textContent=""},n.prototype.emitParameters=function(n,t){for(var r="",i,u=0;u<n.length;u++)i=n[u],u&&(r+=", "),i.optional?t&&t.interface?r+=i.name+"?:"+JSType.fromIDL(i.idlType):typeof i.default!="undefined"?(r+=i.name+":"+JSType.fromIDL(i.idlType),r+=" = "+JSValue.fromIDL(i.default)):r+=i.name+"?:"+JSType.fromIDL(i.idlType):r+=i.name+":"+JSType.fromIDL(i.idlType);return r},n.prototype.emitOperation=function(n,t){var r=t&&!t.interface,i;return r&&(i="//\n// [...]\n//",t.bodyDecorator&&(i=t.bodyDecorator(i))),(t&&t.noName?"":n.name)+"("+this.emitParameters(n.arguments,t)+")"+(n.idlType.idlType=="new"?"":": "+JSType.fromIDL(n.idlType))+(r?"{\n"+new IndentedStringBuilder(i,"    ")+"\n}":";")},n.prototype.emitAttribute=function(n,t){if(t.interface)return n.name+(n.idlType.nullable?"?: ":": ")+JSType.fromIDL(n.idlType)+";";var i=JSType.fromIDL(n.idlType),r="get "+n.name+"() : "+i+" {\n}";return n.readonly||(r+="\nset "+n.name+"(value : "+i+") {\n}"),r},n.prototype.emitInterface=function(n,t){var o=!t||!("interface"in t)||t.interface,r=new IndentedStringBuilder("",""),i=new IndentedStringBuilder("","    "),s,f,h,e;o?r.append("interface "+n.name+(n.inheritance?" extends "+n.inheritance:"")+" {"):(r.append("class "+n.name+(n.inheritance?" extends "+n.inheritance:"")+" {"),n.extAttrs&&(s=n.extAttrs.filter(function(n){return n.name==="Constructor"}),s.length>0&&(i.append("\n//\n// Implementation of the constructor\n//"),i.append(this.emitOperation({type:"operation",name:"constructor",extAttrs:[],getter:!1,setter:!1,legacycaller:!1,creator:!1,deleter:!1,"static":!1,stringifier:!1,arguments:s[0].arguments||[],idlType:{union:!1,array:0,sequence:!1,nullable:!1,idlType:"new"}},{"interface":!1,bodyDecorator:function(n){return"var self = this/*or reuse existing DOM objects by changing their prototype*/;\n"+n+"\nreturn self;"}}))))),r.append(i.toString()),i.code="";for(var c=n.members,l=c.length,u=[];l;){f=c[--l];switch(f.type){case"attribute":h=f,i.prepend(this.emitAttribute(h,{"interface":o})),i.prepend("\n//\n// Implementation of the "+h.name+" attribute\n//");break;case"operation":e=f,e.legacycaller&&u.push(e),i.prepend(this.emitOperation(e,{"interface":o})),i.prepend("\n//\n// Implementation of the "+e.name+" method\n//");break;default:i.prepend("\n// TODO: "+f.name)}}return u.length>0&&(u.length!==1&&(u[0]=this.mergeCallingConventions(u)),i.prepend(this.emitOperation(u[0],{noName:!0,"interface":o}))),r.append(i),i.code&&r.append(""),r.append("}"),r.toString()},n.prototype.mergeCallingConventions=function(n){var i,t,u,f;if(!n&&n.length<1)throw new Error("Unable to merge calling conventions when the number of conventions is smaller than 1");var e=n[0].arguments.reduce(function(n,t){return n+(t.optional?0:1)},0),o=n[0].arguments.length,r=n[0].arguments.map(function(n){return{optional:n.optional,variadic:n.variadic,extAttrs:n.extAttrs,idlType:n.idlType,name:n.name}}),s=JSType.fromIDL(n[0].idlType);for(i=1;i<n.length;i++){for(e=Math.min(e,n[i].arguments.reduce(function(n,t){return n+(t.optional?0:1)},0)),o=Math.max(o,n[i].arguments.length),t=0;t<n[i].arguments.length;t++)r.length<=t?(u=n[i].arguments[t],r[t]={optional:!0,variadic:u.variadic,extAttrs:u.extAttrs,idlType:u.idlType,name:u.name}):JSType.fromIDL(r[t].idlType)!=JSType.fromIDL(n[i].arguments[t].idlType)?r[t]={optional:r[t].optional||n[i].arguments[t].optional,variadic:!1,extAttrs:[],idlType:{union:!1,array:0,sequence:!1,nullable:!1,idlType:"any"},name:r[t].name==n[i].arguments[t].name?r[t].name:"arg"+t}:r[t].name!=n[i].arguments[t].name&&(r[t].name="arg"+t);for(f=e;f<o;f++)r[f].optional=!0;s!=JSType.fromIDL(n[i].idlType)&&(s="any")}return{type:"operation",name:n[0].name,extAttrs:[],getter:!1,setter:!1,legacycaller:n[0].legacycaller,creator:n[0].creator,deleter:n[0].deleter,"static":n[0].static,stringifier:n[0].stringifier,arguments:r,idlType:{union:!1,array:0,sequence:!1,nullable:!1,idlType:s},originalConventions:n}},n.prototype.parseIDLString=function(n,t){typeof t=="undefined"&&(t=!0);var i=this,r=WebIDL2.parse(n);r.forEach(function(n){i.log("// "+n.type+" "+(n.name||n.target||"anonymous"));switch(n.type){case"interface":case"callback interface":case"dictionnary":i.log(i.emitInterface(n,{"interface":t||n.type!="interface"}));break;case"implements":var r=n;i.log("interface "+r.target+" extends "+r.implements+"{}");break;default:i.log("// TODO: "+n.type+" "+n.name)}i.log("")})},n}();window.onload=function(){var n=document.getElementById("input"),t=document.getElementById("output"),i=new TypeScriptHelper(t);i.parseIDLString(n.value,!1)}